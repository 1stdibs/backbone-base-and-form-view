//     Backbone.BaseView 0.3.0
//     (c) 2013 James Ballantine, 1stdibs.com Inc.
//     Backbone.BaseView may be freely distributed under the MIT license.
//     For all details and documentation:
//     https://github.com/1stdibs/backbone-base-and-form-view
!function(a,b,c,d){"use strict";var e,f=function(a){for(var b=a.split("."),c=d[b.shift()];b.length&&c;)c=c[b.shift()];return c},g=Array.prototype.slice,h=b.View,i=function(a,b,c){this._subViews={},this.clear(!0),this.parent=b,this.options=c||{},this.autoInitSingletons=!!this.options.autoInitSingletons,this.dotNotation=void 0!==this.options.dotNotation?this.options.dotNotation:!0,a&&this.addConfig(a)};i.prototype={add:function(a,b,d){var e,f,g,i=c.isArray(a)?a:c.isArray(b)?b:!1,j=!i&&c.isObject(a)&&a instanceof h==!1?a:!1,k=i||b instanceof h!=!1?!1:b;if(j){d="boolean"==typeof b?b:void 0;for(e in j)if(j.hasOwnProperty(e))if(j[e]=c.isArray(j[e])?j[e]:[j[e]],g=j[e].length,g&&j[e][0]instanceof h)this._addInstance(e,j[e],d);else for(f=-1;++f<g;)this._init(e,j[e][f],d);return this}if(b=a instanceof h?a:b,a="string"==typeof a||"number"==typeof a?a:void 0,d="boolean"==typeof d?d:a||"boolean"!=typeof b?void 0:b,k)return this._init(a,k,d),this;if(i&&(g=i.length)){if(i[0]instanceof h)this._addInstance(a,i,d);else for(;++f<g;)this._init(a,i[f],d);return this}return b?this._addInstance(a,b,d):a&&this._init(a,d),this},addConfig:function(a,b){var d=c.isObject(a)&&!c.isArray(a)?a:!1;return d?(c.each(d,this._addConfig,this),this):this._addConfig(b,a)},render:function(a){a=a||{};var b=a.appendTo||a.useLocation;return this._render(this.subViews,b,a.clearLocations)},renderAppend:function(b,d){return d=d||{},c.isObject(b)&&b instanceof a==!1&&!c.isElement(b)&&(d=b,b=d.appendTo),this._render(this.subViews,b||!0,d.clearLocations)},renderByKey:function(a,b){var d=this.getByType(a)||this.get(a);return c.isArray(d)||(d=[d]),this._render(d,b.appendTo||b.useLocation,b.clearLocations)},filteredSubs:function(a){var b,d,e=-1,f=new i(null,this.parent,this.options);for(f._subViews=this._subViews,d=c.isArray(a)?a:c.isFunction(a)?this.filter(a):this.getByType(a),b=d.length;++e<b;)f.add(d[e]._subviewtype,d[e]);return f},descend:function(a,b){var d=c.isFunction(a),e=function(c){for(var f,g,h=-1,i=c.length;++h<i;)f=c[h],g=d?a:f[a],g&&(b?g.apply(f,b):g.call(c[h])),f.subViews&&f.subViews.length&&e(f.subViews)};return e(this.subViews),this},clear:function(a,b){return a||this.removeElems(),this.subViews=[],this.parent&&this.parent.subViews&&(this.parent.subViews=this.subViews),this._subViewsByType={},this._subViewSingletons={},this._subViewsByCid={},this._subViewsByModelCid={},b&&(this._subViews={}),this},remove:function(a,b){var d,e=a&&("string"==typeof a||a.cid)?this.get(a):a;if(!e)return this;for(c.isArray(e)||(e=[e]),d=e?e.length:0,b||this.removeElems(e),d&&this.trigger("remove",e);e&&e.length;)this._remove(e.shift());return this},removeElems:function(a){a=a||this.subViews;for(var b=-1,c=a.length;++b<c;)a[b].remove();return this},get:function(a){if(a.cid)return this._subViewsByCid[a.cid]||this._subViewsByModelCid[a.cid];if(a.indexOf(".")>-1&&this.dotNotation){for(var b=a.split("."),c=this.parent;b.length&&c;)c=c.subs.get(b.shift());return c}return this._subViewSingletons[a]||this._subViewsByCid[a]||this._subViewsByModelCid[a]||this._subViewsByType[a]},getByType:function(a){return this._subViewsByType[a]?this._subViewsByType[a]:this._subViewSingletons[a]?[this._subViewSingletons[a]]:[]},getSubViewType:function(a){return a=a instanceof h==!0?a:this.get(a),a._subviewtype},at:function(a){return this.subViews[a]},clearLocations:function(a){var b=a?c.pick(this._subViews,a):this._subViews;return c.each(b,function(a){this.parent.$(a.location).html("")},this),this},_render:function(a,b,c){var d,e,f=-1,g=a.length,h={};for(b!==!0&&(d=b),c&&this.clearLocations();++f<g;)a[f].render(),d?a[f].$el.appendTo(d):b&&(e=this._subViews[this.getSubViewType(a[f])].location)&&("string"==typeof e&&(h[e]||(h[e]=this.parent.$(e)),e=h[e]),e.append(a[f].$el));return this},_addInstance:function(a,b,d){var e,f=-1,g=this;if(a=a||"_svid_"+c.size(this._subViews),!g._subViewSingletons[a]){for(c.isArray(b)||(b=[b]),e=b.length,!g._subViews[a]&&b[0].constructor&&(g._subViews[a]={options:b[0].options||{},construct:b[0].constructor,singleton:d}),d=void 0===d?g._subViews[a].singleton:d;++f<e;)g._setInst(a,b[f],d);return g}},_addConfig:function(a,b){return this._subViews[b]=a,this.autoInitSingletons&&a.singleton?this._init(b):this},_remove:function(a,b){for(var c=-1,d=this.subViews.length,e=this.getSubViewType(a),f=this.getByType(e);++c<d;)if(this.subViews[c].cid===a.cid){this.subViews.splice(c,1);break}if(d=f?f.length:0,!this._subViewSingletons[e]&&d)for(c=0;d>c;c++)if(f[c].cid===a.cid){f.splice(c,1);break}return delete this._subViewsByCid[a.cid],a.model&&a.model.cid&&this._subViewsByModelCid[a.model.cid]&&delete this._subViewsByModelCid[a.model.cid],this._subViewSingletons[e]&&delete this._subViewSingletons[e],b?void 0:this.trigger("remove:"+e,a)},_setInst:function(a,b,d,e){var f=b.model?b.model.cid:null,g=this._subViewsByModelCid;return this.subViews.push(b),this._subViewsByCid[b.cid]=b,b.parentView||(b.parentView=this.parent),b._subviewtype=a,f&&(g[f]?(c.isArray(g[f])||(g[f]=[g[f]]),g[f].push(b)):this._subViewsByModelCid[f]=b),d?this._subViewSingletons[a]=b:(this._subViewsByType[a]||(this._subViewsByType[a]=[]),this._subViewsByType[a].push(b)),e?this:this.trigger("add",b).trigger("add:"+a,b)},_init:function(a,b,d){var e,g=this._subViews[a],h=g&&g.construct?g.construct:null;return b=c.extend({},g.options||{},b||{}),this._subViewSingletons[a]?void 0:(h="string"==typeof h?f(h):h,e=this.subViews[a]=new h(b,this.parent),this._setInst(a,e,void 0!==d?d:g.singleton),this)}},c.each(["each","initial","rest","last","first","find","filter","sortBy","groupBy","where","findWhere","some","every","invoke"],function(a){i.prototype[a]=function(){return c[a].apply(this,[this.subViews].concat(g.call(arguments)))}}),c.extend(i.prototype,b.Events),e=h.extend({subViews:null,subs:null,subViewConfig:null,autoInitSubViews:!1,parentView:null,_stopPropogation:{},constructor:function(a,b){var d=a&&a.subViewConfig?c.result(a,"subViewConfig"):c.result(this,"subViewConfig");this.parentView=b instanceof h?b:null,this.subs=new i(null,this,{autoInitSingletons:this.autoInitSubViews}),d&&this.subs.addConfig(d),this.subViews=this.subs.subViews,e.__super__.constructor.call(this,a),(this.viewEvents||this.options.viewEvents)&&this.bindViewEvents()},place:function(b,c){if("string"==typeof b){var d=this.parentView?this.parentView.$el:a("body");b=d.find(b)}return c?(b.html(this.el),this):(b.append(this.el),this)},stopEvent:function(a){return this._stopPropogation[a]=!0,this},triggerBubble:function(a){var b,c=g.call(arguments,1);if(c.unshift(a),c.push(this),this.trigger.apply(this,c),this._stopPropogation[a])return this._stopPropogation[a]=!1,this;for(b=this.parentView;b;){if(b._stopPropogation&&b._stopPropogation[a])return b._stopPropogation[a]=!1,this;b.trigger.apply(b,c),b=b.parentView}return this},triggerDescend:function(a){var b=g.call(arguments,1),c=function(d){for(var e,f,g,h=-1,i=d.length;++h<i;)g=!0,(f=d[h]._stopPropogation)&&f[a]&&(f[a]=!1,g=!1),d[h].trigger.apply(d[h],b),e=d[h].subViews,g&&e&&e.length&&c(e)};return b.unshift(a),b.push(this),c([this]),this},findAncestor:function(a){for(var b=this;b.parentView;)if(b=b.parentView,b&&a&&a===b._subviewtype)return b;return null},getSubViewType:function(){return this._subviewtype},getTopView:function(){for(var a=this;a.parentView;)a=a.parentView;return a},isTopView:function(){return!this.parentView},bindViewEvents:function(a){return a=a||c.extend({},c.result(this,"viewEvents"),c.result(this.options,"viewEvents")),c.each(a,function(a,b){var d=b.split(" "),e=d.length>1?this[d[1]]:this;a=c.isFunction(a)?a:this[a],e&&(this.stopListening(e,d[0],a),this.listenTo(e,d[0],a))},this),this}}),b.BaseView=e}(jQuery,Backbone,_,this);